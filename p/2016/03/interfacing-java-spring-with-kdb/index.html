<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Interfacing Java Spring with kdb</title><meta name=description content="How to access an KDB server from Spring Framework"><meta name=copyright content="&copy; 2015 to present"><meta http-equiv=cleartype content="on"><meta name=generator content="Hugo 0.85.0"><link rel=stylesheet href=/css/styles.min.47e1f61ca71da5c5782a8f50fe9300c8d94afeaa3201f530bdc6748c602ed51c.css integrity=sha256-R+H2HKcdpcV4Ko9Q/pMAyNlK/qoyAfUwvcZ0jGAu1Rw=><link rel=icon type=image/png href=/favicon.png></head><body class="flex flex-col min-h-screen"><header class="w-all px-4 pt-4"><style type=text/css>input#nav-toggle:checked~label#show-button{display:none}input#nav-toggle:checked~label#hide-button{display:flex}input#nav-toggle:checked~#nav-menu{display:block}</style><nav class="flex w-10/12 content-end items-center justify-between flex-wrap mt-6 mx-auto"><span class=flex></span><input id=nav-toggle type=checkbox class=hidden>
<label id=show-button for=nav-toggle class="flex items-center block md:hidden text-ridiculousblue hover:text-ridiculousorange"><svg class="fill-current h-4 w-4" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu Open</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0V0z"/></svg></label><label id=hide-button for=nav-toggle class="flex items-center hidden text-ridiculousblue hover:text-ridiculousorange"><svg class="fill-current h-4 w-4" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu Close</title><polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)"/></svg></label><ul id=nav-menu class="text-x95 md:flex w-9/12 md:w-auto hidden md:block mt-2 md:mt-0 md:space-x-2 text-ridiculousblue font-baloo font-medium"><li><a class="mr-4 hover:text-ridiculousorange" href=/ title>HOME</a></li><li><a class="mr-4 hover:text-ridiculousorange" href=/posts/ title>POSTS</a></li><li><a class="mr-4 hover:text-ridiculousorange" href=/about/ title>ABOUT</a></li></ul></nav></header><main class="flex-1 mx-4 md:mx-12 lg:mx-24"><style type=text/css>.prose pre code{color:#181818}</style><article class="px-6 mx-auto mb-16 prose prose-baloo prose-sm 2xl:prose prose-ridiculousblue justify-self-center sm:px-4 md:px-0 pt-8 md:pt-12"><h1>Interfacing Java Spring with kdb</h1><p>The classic way to access a kdb server from java is via the <a href=https://github.com/KxSystems/javakdb/blob/master/src/kx/c.java>c class</a>. The jdbc implementation makes it easy to interface with a kdb database providing higher level methods to establish a database connection, parse the returned object. One drawback is that it does not support retrieving result that is not a table. Let&rsquo;s go over a short guide on how to use jdbc to connect to kdb.</p><h2 id=kdb-server>kdb Server</h2><p>First letâ€™s start a kdb process to which the java client will connect over TCP port 7000. You can choose any port you like.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ./q
KDB+ 3.3 2016.03.14 Copyright <span style=color:#000;font-weight:700>(</span>C<span style=color:#000;font-weight:700>)</span> 1993-2016 Kx Systems
m32/ 4<span style=color:#000;font-weight:700>()</span>core 8192MB subha tuchanka.local 192.168.0.101 NONEXPIRE

q<span style=color:#000;font-weight:700>)</span><span style=color:#d14>\p</span> <span style=color:#099>7000</span>
q<span style=color:#000;font-weight:700>)</span></code></pre></td></tr></table></div></div><h2 id=spring-java-clent>Spring Java Clent</h2><h3 id=maven-configuration>Maven Configuration</h3><p>We are going to use Spring Boot with jdbc starter. Spring boot further simplifies the code by configuring Spring automatically wherever possible. <code>spring-boot-starter-jdbc</code> provides support for jdbc.</p><p><code>pom.xml</code>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#999;font-weight:700;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style=color:navy>&lt;project</span> <span style=color:teal>xmlns=</span><span style=color:#d14>&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
    <span style=color:teal>xmlns:xsi=</span><span style=color:#d14>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
    <span style=color:teal>xsi:schemaLocation=</span><span style=color:#d14>&#34;http://maven.apache.org/POM/4.0.0
</span><span style=color:#d14>                        http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style=color:navy>&gt;</span>
    <span style=color:navy>&lt;modelVersion&gt;</span>4.0.0<span style=color:navy>&lt;/modelVersion&gt;</span>

    <span style=color:navy>&lt;groupId&gt;</span>com.example<span style=color:navy>&lt;/groupId&gt;</span>
    <span style=color:navy>&lt;artifactId&gt;</span>spring-kdb<span style=color:navy>&lt;/artifactId&gt;</span>
    <span style=color:navy>&lt;version&gt;</span>0.0.1-SNAPSHOT<span style=color:navy>&lt;/version&gt;</span>
    <span style=color:navy>&lt;packaging&gt;</span>jar<span style=color:navy>&lt;/packaging&gt;</span>

    <span style=color:navy>&lt;name&gt;</span>spring-kdb<span style=color:navy>&lt;/name&gt;</span>
    <span style=color:navy>&lt;description&gt;</span>Demo project for Spring kdb Integration<span style=color:navy>&lt;/description&gt;</span>

    <span style=color:navy>&lt;parent&gt;</span>
        <span style=color:navy>&lt;groupId&gt;</span>org.springframework.boot<span style=color:navy>&lt;/groupId&gt;</span>
        <span style=color:navy>&lt;artifactId&gt;</span>spring-boot-starter-parent<span style=color:navy>&lt;/artifactId&gt;</span>
        <span style=color:navy>&lt;version&gt;</span>1.3.3.RELEASE<span style=color:navy>&lt;/version&gt;</span>
        <span style=color:navy>&lt;relativePath/&gt;</span> <span style=color:#998;font-style:italic>&lt;!-- lookup parent from repository --&gt;</span>
    <span style=color:navy>&lt;/parent&gt;</span>

    <span style=color:navy>&lt;properties&gt;</span>
        <span style=color:navy>&lt;project.build.sourceEncoding&gt;</span>UTF-8<span style=color:navy>&lt;/project.build.sourceEncoding&gt;</span>
        <span style=color:navy>&lt;java.version&gt;</span>1.8<span style=color:navy>&lt;/java.version&gt;</span>
    <span style=color:navy>&lt;/properties&gt;</span>

    <span style=color:navy>&lt;dependencies&gt;</span>
        <span style=color:navy>&lt;dependency&gt;</span>
            <span style=color:navy>&lt;groupId&gt;</span>org.springframework.boot<span style=color:navy>&lt;/groupId&gt;</span>
            <span style=color:navy>&lt;artifactId&gt;</span>spring-boot-starter-jdbc<span style=color:navy>&lt;/artifactId&gt;</span>
        <span style=color:navy>&lt;/dependency&gt;</span>

        <span style=color:navy>&lt;dependency&gt;</span>
            <span style=color:navy>&lt;groupId&gt;</span>org.springframework.boot<span style=color:navy>&lt;/groupId&gt;</span>
            <span style=color:navy>&lt;artifactId&gt;</span>spring-boot-starter-test<span style=color:navy>&lt;/artifactId&gt;</span>
            <span style=color:navy>&lt;scope&gt;</span>test<span style=color:navy>&lt;/scope&gt;</span>
        <span style=color:navy>&lt;/dependency&gt;</span>
    <span style=color:navy>&lt;/dependencies&gt;</span>

    <span style=color:navy>&lt;build&gt;</span>
        <span style=color:navy>&lt;plugins&gt;</span>
            <span style=color:navy>&lt;plugin&gt;</span>
                <span style=color:navy>&lt;groupId&gt;</span>org.springframework.boot<span style=color:navy>&lt;/groupId&gt;</span>
                <span style=color:navy>&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style=color:navy>&lt;/artifactId&gt;</span>
            <span style=color:navy>&lt;/plugin&gt;</span>
        <span style=color:navy>&lt;/plugins&gt;</span>
    <span style=color:navy>&lt;/build&gt;</span>
<span style=color:navy>&lt;/project&gt;</span></code></pre></td></tr></table></div></div><h3 id=configuring-datasource>Configuring Datasource</h3><p>The jdbc driver for kdb not available in maven. It can be downloaded from <a href=http://kx.com/q/c/jdbc.jar>kx repository</a>. You can add it as a <a href=http://stackoverflow.com/questions/3280353/how-to-import-a-jar-in-eclipse>build dependency</a> or <a href=http://www.mkyong.com/maven/how-to-include-library-manully-into-maven-local-repository/>add to your local maven repo</a> and use it as a maven dependency. I am going to use the first approach.</p><p>Configure the driver class name and server URL in the <code>application.properties</code> file.</p><p><code>/src/main/resources/application.properties</code>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>spring.datasource.driverClassName=jdbc
spring.datasource.url=jdbc:q:localhost:7000</code></pre></td></tr></table></div></div><h3 id=connecting-to-kdb>Connecting to kdb</h3><p>Spring boot will automatically configure the datasource class from the <code>application.properties</code> and you can use <code>@Autowired</code> annotation to pass it to a <code>jdbcTemplate</code>.</p><p>Let&rsquo;s make a kdb terminal in Java.</p><p><code>src/main/java/hello/Application.java</code>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#000;font-weight:700>package</span> <span style=color:#555>hello</span><span style=color:#000;font-weight:700>;</span>

<span style=color:#000;font-weight:700>import</span> <span style=color:#555>org.springframework.beans.factory.annotation.Autowired</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>org.springframework.boot.CommandLineRunner</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>org.springframework.boot.SpringApplication</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>org.springframework.boot.autoconfigure.SpringBootApplication</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>org.springframework.jdbc.core.JdbcTemplate</span><span style=color:#000;font-weight:700>;</span>

<span style=color:#000;font-weight:700>import</span> <span style=color:#555>java.io.BufferedReader</span><span style=color:#000;font-weight:700>;</span>




<span style=color:#000;font-weight:700>import</span> <span style=color:#555>java.io.IOException</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>java.io.InputStreamReader</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>java.sql.ResultSet</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>java.sql.ResultSetMetaData</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>java.sql.SQLException</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#998;font-style:italic>//tab:flip `items`sales`prices!(`nut`bolt`cam`cog;6 8 0 3;10 20 15 20)
</span><span style=color:#998;font-style:italic></span><span style=color:#3c5d5d;font-weight:700>@SpringBootApplication</span>
<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>Application</span> <span style=color:#000;font-weight:700>implements</span> CommandLineRunner <span style=color:#000;font-weight:700>{</span>

    <span style=color:#3c5d5d;font-weight:700>@Autowired</span>
    JdbcTemplate jdbcTemplate<span style=color:#000;font-weight:700>;</span>

    <span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>static</span> <span style=color:#458;font-weight:700>void</span> <span style=color:#900;font-weight:700>main</span><span style=color:#000;font-weight:700>(</span>String args<span style=color:#000;font-weight:700>[])</span> <span style=color:#000;font-weight:700>{</span>
        SpringApplication<span style=color:#000;font-weight:700>.</span><span style=color:teal>run</span><span style=color:#000;font-weight:700>(</span>Application<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>,</span> args<span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#3c5d5d;font-weight:700>@Override</span>
    <span style=color:#000;font-weight:700>public</span> <span style=color:#458;font-weight:700>void</span> <span style=color:#900;font-weight:700>run</span><span style=color:#000;font-weight:700>(</span>String<span style=color:#000;font-weight:700>...</span> strings<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>throws</span> IOException <span style=color:#000;font-weight:700>{</span>
        InputStreamReader isr <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> InputStreamReader<span style=color:#000;font-weight:700>(</span>System<span style=color:#000;font-weight:700>.</span><span style=color:teal>in</span><span style=color:#000;font-weight:700>);</span>
        BufferedReader br <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> BufferedReader<span style=color:#000;font-weight:700>(</span>isr<span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>while</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>true</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            System<span style=color:#000;font-weight:700>.</span><span style=color:teal>out</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;q) &#34;</span><span style=color:#000;font-weight:700>);</span>
            String sql <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;q)&#34;</span> <span style=color:#000;font-weight:700>+</span> br<span style=color:#000;font-weight:700>.</span><span style=color:teal>readLine</span><span style=color:#000;font-weight:700>();</span>
            <span style=color:#000;font-weight:700>try</span> <span style=color:#000;font-weight:700>{</span>
                jdbcTemplate<span style=color:#000;font-weight:700>.</span><span style=color:teal>query</span><span style=color:#000;font-weight:700>(</span>sql<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>(</span>ResultSet rowSet<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>{</span>
                        ResultSetMetaData m<span style=color:#000;font-weight:700>;</span>
                        m <span style=color:#000;font-weight:700>=</span> rowSet<span style=color:#000;font-weight:700>.</span><span style=color:teal>getMetaData</span><span style=color:#000;font-weight:700>();</span>
                        <span style=color:#458;font-weight:700>int</span> columnCount <span style=color:#000;font-weight:700>=</span> m<span style=color:#000;font-weight:700>.</span><span style=color:teal>getColumnCount</span><span style=color:#000;font-weight:700>();</span>
                        String fmt<span style=color:#000;font-weight:700>[]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> String<span style=color:#000;font-weight:700>[</span>columnCount <span style=color:#000;font-weight:700>+</span> 1<span style=color:#000;font-weight:700>];</span>
                        <span style=color:#458;font-weight:700>int</span> width <span style=color:#000;font-weight:700>=</span> 0<span style=color:#000;font-weight:700>;</span>

                        <span style=color:#000;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#458;font-weight:700>int</span> i <span style=color:#000;font-weight:700>=</span> 1<span style=color:#000;font-weight:700>;</span> i <span style=color:#000;font-weight:700>&lt;=</span> columnCount<span style=color:#000;font-weight:700>;</span> i<span style=color:#000;font-weight:700>++)</span> <span style=color:#000;font-weight:700>{</span>
                            fmt<span style=color:#000;font-weight:700>[</span>i<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;%-&#34;</span> <span style=color:#000;font-weight:700>+</span> m<span style=color:#000;font-weight:700>.</span><span style=color:teal>getColumnDisplaySize</span><span style=color:#000;font-weight:700>(</span>i<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>+</span> <span style=color:#d14>&#34;s&#34;</span><span style=color:#000;font-weight:700>;</span>
                            System<span style=color:#000;font-weight:700>.</span><span style=color:teal>out</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>format</span><span style=color:#000;font-weight:700>(</span>fmt<span style=color:#000;font-weight:700>[</span>i<span style=color:#000;font-weight:700>],</span> m<span style=color:#000;font-weight:700>.</span><span style=color:teal>getColumnLabel</span><span style=color:#000;font-weight:700>(</span>i<span style=color:#000;font-weight:700>));</span>
                            width <span style=color:#000;font-weight:700>+=</span> rowSet<span style=color:#000;font-weight:700>.</span><span style=color:teal>getMetaData</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>getColumnDisplaySize</span><span style=color:#000;font-weight:700>(</span>i<span style=color:#000;font-weight:700>);</span>
                        <span style=color:#000;font-weight:700>}</span>
                        System<span style=color:#000;font-weight:700>.</span><span style=color:teal>out</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;\n&#34;</span><span style=color:#000;font-weight:700>);</span>

                        <span style=color:#000;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#458;font-weight:700>int</span> i <span style=color:#000;font-weight:700>=</span> 1<span style=color:#000;font-weight:700>;</span> i <span style=color:#000;font-weight:700>&lt;=</span> width<span style=color:#000;font-weight:700>;</span> i<span style=color:#000;font-weight:700>++)</span> <span style=color:#000;font-weight:700>{</span>
                            System<span style=color:#000;font-weight:700>.</span><span style=color:teal>out</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;-&#34;</span><span style=color:#000;font-weight:700>);</span>
                        <span style=color:#000;font-weight:700>}</span>
                        System<span style=color:#000;font-weight:700>.</span><span style=color:teal>out</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;\n&#34;</span><span style=color:#000;font-weight:700>);</span>

                        <span style=color:#000;font-weight:700>do</span><span style=color:#000;font-weight:700>{</span>
                            <span style=color:#000;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#458;font-weight:700>int</span> i <span style=color:#000;font-weight:700>=</span> 1<span style=color:#000;font-weight:700>;</span> i <span style=color:#000;font-weight:700>&lt;=</span> columnCount<span style=color:#000;font-weight:700>;</span> i<span style=color:#000;font-weight:700>++)</span> <span style=color:#000;font-weight:700>{</span>
                                System<span style=color:#000;font-weight:700>.</span><span style=color:teal>out</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>format</span><span style=color:#000;font-weight:700>(</span>fmt<span style=color:#000;font-weight:700>[</span>i<span style=color:#000;font-weight:700>],</span> rowSet<span style=color:#000;font-weight:700>.</span><span style=color:teal>getString</span><span style=color:#000;font-weight:700>(</span>i<span style=color:#000;font-weight:700>));</span>
                            <span style=color:#000;font-weight:700>}</span>
                            System<span style=color:#000;font-weight:700>.</span><span style=color:teal>out</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;\n&#34;</span><span style=color:#000;font-weight:700>);</span>
                            <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span>rowSet<span style=color:#000;font-weight:700>.</span><span style=color:teal>getRow</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>&gt;</span> 10<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
                                System<span style=color:#000;font-weight:700>.</span><span style=color:teal>out</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;...&#34;</span><span style=color:#000;font-weight:700>);</span>
                                rowSet<span style=color:#000;font-weight:700>.</span><span style=color:teal>afterLast</span><span style=color:#000;font-weight:700>();</span>
                            <span style=color:#000;font-weight:700>}</span>
                        <span style=color:#000;font-weight:700>}</span><span style=color:#000;font-weight:700>while</span> <span style=color:#000;font-weight:700>(</span>rowSet<span style=color:#000;font-weight:700>.</span><span style=color:teal>next</span><span style=color:#000;font-weight:700>());</span>
                    <span style=color:#000;font-weight:700>});</span>
            <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>catch</span> <span style=color:#000;font-weight:700>(</span>RuntimeException e<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#000;font-weight:700>if</span><span style=color:#000;font-weight:700>(</span>e<span style=color:#000;font-weight:700>.</span><span style=color:teal>getCause</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>instanceof</span> SQLException<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
                    System<span style=color:#000;font-weight:700>.</span><span style=color:teal>out</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>println</span><span style=color:#000;font-weight:700>(</span>e<span style=color:#000;font-weight:700>.</span><span style=color:teal>getCause</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>getMessage</span><span style=color:#000;font-weight:700>());</span>
                <span style=color:#000;font-weight:700>}</span>
            <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span></code></pre></td></tr></table></div></div><p>We are using <code>RowCallbackHandler</code> as we shall be processing the rows immediately. You can do away with all the SQL cuteness and run q statements directly by prefixing q statements with <code>q)</code>. All the exceptions from the jdbc class are thrown as runtime exceptions. An <code>SQLException</code> is generated if execution of the query fails. Apart from that <code>NullPointerException</code> is generated if a statement returns nothing upon execution such as assignment expressions <code>somevar:10</code>; and <code>ClassCastException</code> is thrown if you try to retrieve anything other than a table. Here I am handling only the <code>SQLException</code>s and masking all the others - which generally is not a good practice.</p><p>You need to first start the kdb server. You can run the client within eclipse or as a jar:</p><figure><img src=/img/P2_01.gif></img></figure><p>You can find the complete project <a href=https://github.com/subhc/blogcodes/tree/master/spring-kdb-demo>here</a>.</p><div class=mt-20><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//kanche.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></main><script>console.log("Some pages use FontAwesome icons, license is found here: https://fontawesome.com/license")</script></body><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-66564594-1','auto'),ga('send','pageview'))</script></html>